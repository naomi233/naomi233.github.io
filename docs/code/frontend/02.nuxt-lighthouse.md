---
title: Nuxt3 优化 LightHouse 得分
category: 折腾记录
tag:
  - Nuxt
---

LightHouse 有五个指标 FCP LCP TBT CLS SI

## FCP

- First Contentful Paint 第一个内容绘制

TTBF - Time to First Byte 首个字节时间，反应了服务器响应时间

对于静态html，可以使用cdn加速，避免频繁回源服务器，相对应的更新程序后，需要刷新cdn缓存

服务器开启Server Timing，监控服务器响应时间

服务器开启gzip、brotli压缩，减少资源体积

服务器开启http/2协议，复用http请求，减少网络延迟

由于浏览器必须先下载阻塞css才能渲染页面，所以可以考虑以下两种

可选路线：

1. 内联css文件

使用内联css样式到html，避免加载css 导致render blocking

由于我们将css内联至html，所以需要删除Nuxt注入的全局css `entry.[hash].css`

2. 保留css文件

使用cdn加速css文件

## LCP

- Largest Contentful Paint 最大内容绘制

使用lazyload，非首屏图片懒加载

避免动态插入LCP元素，否则要等待js加载完成后才能绘制

使用cdn加速图片、字体、脚本等静态资源

调整大小和压缩图片，优先使用webp格式图片

html head中添加`preconnect`和`dns-prefetch`，提前DNS解析域名，建立TCP连接、TLS握手

关闭Nuxt的prefetch标签，避免不必要的请求

## CLS

- Cumulative Layout Shift 累积布局偏移

避免使用动态插入的内容，导致页面布局变化

容器增加骨架大小，或者设置min-height、min-width，避免内容加载后导致布局变化

关闭vite的cssCodeSplit，使用一个单独的全局CSS文件，避免css加载顺序导致的布局变化

## TBT

- Total Blocking Time

对于引入的第三方脚本中会影响布局渲染的，需要启用`defer`属性延迟加载，避免阻塞主线程

延迟Nuxt水合渲染，欺骗Lighthouse <https://github.com/harlan-zw/nuxt-delay-hydration>

## SI

- Speed Index 速度指数

与FCP、LCP挂钩，提高FCP、LCP，对应的SI也会提高
